<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>v8pp: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">v8pp
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Bind C++ code into V8 JavaScript engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">v8pp Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class=""><a href="https://travis-ci.org/pmed/v8pp"></a> <a href="https://ci.appveyor.com/project/pmed/v8pp"></a> <a href="https://npmjs.com/package/v8pp"></a> <a href="https://gitter.im/pmed/v8pp?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"></a></p>
<h1>v8pp</h1>
<p class="">Header-only library to expose C++ classes and functions into <a href="https://developers.google.com/v8/">V8</a> to use them in JavaScript code. v8pp uses heavy template metaprogramming and variadic template parameters which requires modern compiler with C++11 support. The library has been tested on:</p>
<ul>
<li>Microsoft Visual C++ 2015/2017 (Windows 10)</li>
<li>GCC 5.4.0 (Ubuntu 16.04)</li>
<li>Clang 5.0.0 (Ubuntu 16.04)</li>
</ul>
<h2>Binding example</h2>
<p class="">v8pp supports V8 versions after 6.3 with <code>v8::Isolate</code> usage in API. There are 2 targets for binding:</p>
<ul>
<li><code><a class="el" href="classv8pp_1_1module.html" title="Module (similar to v8::ObjectTemplate) ">v8pp::module</a></code>, a wrapper class around <code>v8::ObjectTemplate</code></li>
<li><code><a class="el" href="classv8pp_1_1class__.html" title="Interface to access C++ classes bound to V8. ">v8pp::class_</a></code>, a template class wrapper around <code>v8::FunctionTemplate</code></li>
</ul>
<p class="">Both of them require a pointer to <code>v8::Isolate</code> instance. They allows to bind from C++ code such items as variables, functions, constants with a function <code>set(name, item)</code>:</p>
<p class="">```c++ v8::Isolate* isolate;</p>
<p class="">int var; int get_var() { return var + 1; } void set_var(int x) { var = x + 1; }</p>
<p class="">struct X { X(int v, bool u) : var(v) {} int var; int get() const { return var; } voi set(int x) { var = x; } };</p>
<p class="">// bind free variables and functions <a class="el" href="classv8pp_1_1module.html" title="Module (similar to v8::ObjectTemplate) ">v8pp::module</a> mylib(isolate); mylib // set read-only attribute .set_const("PI", 3.1415) // set variable available in JavaScript with name <code>var</code> .set("var", var) // set function get_var as <code>fun</code> .set("fun", &amp;get_var) // set property <code>prop</code> with getter get_var() and setter set_var() .set("prop", property(get_var, set_var));</p>
<p class="">// bind class v8pp::class_&lt;X&gt; X_class(isolate); X_class // specify X constructor signature .ctor&lt;int, bool&gt;() // bind variable .set("var", &amp;X::var) // bind function .set("fun", &amp;X::set) // bind read-only property .set("prop", property(&amp;X::get));</p>
<p class="">// set class into the module template mylib.set("X", X_class);</p>
<p class="">// set bindings in global object as <code>mylib</code> isolate-&gt;GetCurrentContext()-&gt;Global()-&gt;Set( v8::String::NewFromUtf8(isolate, "mylib"), mylib.new_instance()); </p><div class="fragment"><div class="line">After that bindings will be available in JavaScript:</div><div class="line">```javascript</div><div class="line">mylib.var = mylib.PI + mylib.fun();</div><div class="line">var x = new mylib.X(1, true);</div><div class="line">mylib.prop = x.prop + x.fun();</div></div><!-- fragment --><h2>Node.js and io.js addons</h2>
<p class="">The library is suitable to make <a href="http://nodejs.org/">Node.js</a> and <a href="https://iojs.org/">io.js</a> addons. See addons document.</p>
<div class="fragment"><div class="line">{c++}</div><div class="line"></div><div class="line">void RegisterModule(v8::Handle&lt;v8::Object&gt; exports)</div><div class="line">{</div><div class="line">    v8pp::module addon(v8::Isolate::GetCurrent());</div><div class="line"></div><div class="line">    // set bindings... </div><div class="line">    addon</div><div class="line">        .set(&quot;fun&quot;, &amp;function)</div><div class="line">        .set(&quot;cls&quot;, my_class)</div><div class="line">        ;</div><div class="line"></div><div class="line">    // set bindings as exports object prototype</div><div class="line">    exports-&gt;SetPrototype(addon.new_instance());</div><div class="line">}</div></div><!-- fragment --><h2>v8pp also provides</h2>
<ul>
<li><code>v8pp</code> - a static library to add several global functions (load/require to the v8 JavaScript context. <code>require()</code> is a system for loading plugins from shared libraries.</li>
<li><code>test</code> - A binary for running JavaScript files in a context which has v8pp module loading functions provided.</li>
</ul>
<h2>v8pp module example</h2>
<div class="fragment"><div class="line">{c++}</div><div class="line">#include &lt;iostream&gt;</div><div class="line"></div><div class="line">#include &lt;v8pp/module.hpp&gt;</div><div class="line"></div><div class="line">namespace console {</div><div class="line"></div><div class="line">void log(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp; args)</div><div class="line">{</div><div class="line">    v8::HandleScope handle_scope(args.GetIsolate());</div><div class="line"></div><div class="line">    for (int i = 0; i &lt; args.Length(); ++i)</div><div class="line">    {</div><div class="line">        if (i &gt; 0) std::cout &lt;&lt; &#39; &#39;;</div><div class="line">        v8::String::Utf8Value str(args[i]);</div><div class="line">        std::cout &lt;&lt;  *str;</div><div class="line">    }</div><div class="line">    std::cout &lt;&lt; std::endl;</div><div class="line">}</div><div class="line"></div><div class="line">v8::Handle&lt;v8::Value&gt; init(v8::Isolate* isolate)</div><div class="line">{</div><div class="line">    v8pp::module m(isolate);</div><div class="line">    m.set(&quot;log&quot;, &amp;log);</div><div class="line">    return m.new_instance();</div><div class="line">}</div><div class="line"></div><div class="line">} // namespace console</div></div><!-- fragment --><h2>Turning a v8pp module into a v8pp plugin</h2>
<div class="fragment"><div class="line">{c++}</div><div class="line">V8PP_PLUGIN_INIT(v8::Isolate* isolate)</div><div class="line">{</div><div class="line">    return console::init(isolate);</div><div class="line">}</div></div><!-- fragment --><h2>v8pp class binding example</h2>
<div class="fragment"><div class="line">{c++}</div><div class="line">#include &lt;v8pp/module.hpp&gt;</div><div class="line">#include &lt;v8pp/class.hpp&gt;</div><div class="line"></div><div class="line">#include &lt;fstream&gt;</div><div class="line"></div><div class="line">namespace file {</div><div class="line"></div><div class="line">bool rename(char const* src, char const* dest)</div><div class="line">{</div><div class="line">    return std::rename(src, dest) == 0;</div><div class="line">}</div><div class="line"></div><div class="line">class file_base</div><div class="line">{</div><div class="line">public:</div><div class="line">    bool is_open() const { return stream_.is_open(); }</div><div class="line">    bool good() const { return stream_.good(); }</div><div class="line">    bool eof() const { return stream_.eof(); }</div><div class="line">    void close() { stream_.close(); }</div><div class="line"></div><div class="line">protected:</div><div class="line">    std::fstream stream_;</div><div class="line">};</div><div class="line"></div><div class="line">class file_writer : public file_base</div><div class="line">{</div><div class="line">public:</div><div class="line">    explicit file_writer(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp; args)</div><div class="line">    {</div><div class="line">        if (args.Length() == 1)</div><div class="line">        {</div><div class="line">            v8::String::Utf8Value str(args[0]);</div><div class="line">            open(*str);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    bool open(char const* path)</div><div class="line">    {</div><div class="line">        stream_.open(path, std::ios_base::out);</div><div class="line">        return stream_.good();</div><div class="line">    }</div><div class="line"></div><div class="line">    void print(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp; args)</div><div class="line">    {</div><div class="line">        v8::HandleScope scope(args.GetIsolate());</div><div class="line"></div><div class="line">        for (int i = 0; i &lt; args.Length(); ++i)</div><div class="line">        {</div><div class="line">            if (i &gt; 0) stream_ &lt;&lt; &#39; &#39;;</div><div class="line">            v8::String::Utf8Value str(args[i]);</div><div class="line">            stream_ &lt;&lt; *str;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    void println(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp; args)</div><div class="line">    {</div><div class="line">        print(args);</div><div class="line">        stream_ &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line">class file_reader : public file_base</div><div class="line">{</div><div class="line">public:</div><div class="line">    explicit file_reader(char const* path)</div><div class="line">    {</div><div class="line">        open(path);</div><div class="line">    }</div><div class="line"></div><div class="line">    bool open(const char* path)</div><div class="line">    {</div><div class="line">        stream_.open(path, std::ios_base::in);</div><div class="line">        return stream_.good();</div><div class="line">    }</div><div class="line"></div><div class="line">    v8::Handle&lt;v8::Value&gt; getline(v8::Isolate* isolate)</div><div class="line">    {</div><div class="line">        if ( stream_.good() &amp;&amp; ! stream_.eof())</div><div class="line">        {</div><div class="line">            std::string line;</div><div class="line">            std::getline(stream_, line);</div><div class="line">            return v8pp::to_v8(isolate, line);</div><div class="line">        }</div><div class="line">        else</div><div class="line">        {</div><div class="line">            return v8::Undefined(isolate);</div><div class="line">        }</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line">v8::Handle&lt;v8::Value&gt; init(v8::Isolate* isolate)</div><div class="line">{</div><div class="line">    v8::EscapableHandleScope scope(isolate);</div><div class="line"></div><div class="line">    // file_base binding, no .ctor() specified, object creation disallowed in JavaScript</div><div class="line">    v8pp::class_&lt;file_base&gt; file_base_class(isolate);</div><div class="line">    file_base_class</div><div class="line">        .set(&quot;close&quot;, &amp;file_base::close)</div><div class="line">        .set(&quot;good&quot;, &amp;file_base::good)</div><div class="line">        .set(&quot;is_open&quot;, &amp;file_base::is_open)</div><div class="line">        .set(&quot;eof&quot;, &amp;file_base::eof)</div><div class="line">        ;</div><div class="line"></div><div class="line">    // .ctor&lt;&gt; template arguments declares types of file_writer constructor</div><div class="line">    // file_writer inherits from file_base_class</div><div class="line">    v8pp::class_&lt;file_writer&gt; file_writer_class(isolate);</div><div class="line">    file_writer_class</div><div class="line">        .ctor&lt;v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;&gt;()</div><div class="line">        .inherit&lt;file_base&gt;()</div><div class="line">        .set(&quot;open&quot;, &amp;file_writer::open)</div><div class="line">        .set(&quot;print&quot;, &amp;file_writer::print)</div><div class="line">        .set(&quot;println&quot;, &amp;file_writer::println)</div><div class="line">        ;</div><div class="line"></div><div class="line">    // .ctor&lt;&gt; template arguments declares types of file_reader constructor.</div><div class="line">    // file_base inherits from file_base_class</div><div class="line">    v8pp::class_&lt;file_reader&gt; file_reader_class(isolate);</div><div class="line">    file_reader_class</div><div class="line">        .ctor&lt;char const*&gt;()</div><div class="line">        .inherit&lt;file_base&gt;()</div><div class="line">        .set(&quot;open&quot;, &amp;file_reader::open)</div><div class="line">        .set(&quot;getln&quot;, &amp;file_reader::getline)</div><div class="line">        ;</div><div class="line"></div><div class="line">    // Create a module to add classes and functions to and return a</div><div class="line">    // new instance of the module to be embedded into the v8 context</div><div class="line">    v8pp::module m(isolate);</div><div class="line">    m.set(&quot;rename&quot;, &amp;rename)</div><div class="line">     .set(&quot;writer&quot;, file_writer_class)</div><div class="line">     .set(&quot;reader&quot;, file_reader_class)</div><div class="line">        ;</div><div class="line"></div><div class="line">    return scope.Escape(m.new_instance());</div><div class="line">}</div><div class="line"></div><div class="line">} // namespace file</div><div class="line"></div><div class="line">V8PP_PLUGIN_INIT(v8::Isolate* isolate)</div><div class="line">{</div><div class="line">    return file::init(isolate);</div><div class="line">}</div></div><!-- fragment --><h2>Creating a v8 context capable of using require() function</h2>
<div class="fragment"><div class="line">{c++}</div><div class="line">#include &lt;v8pp/context.hpp&gt;</div><div class="line"></div><div class="line">v8pp::context context;</div><div class="line">context.set_lib_path(&quot;path/to/plugins/lib&quot;);</div><div class="line">// script can now use require() function. An application</div><div class="line">// that uses v8pp::context must link against v8pp library.</div><div class="line">v8::HandleScope scope(context.isolate());</div><div class="line">context.run_file(&quot;some_file.js&quot;);</div></div><!-- fragment --><h2>Using require() from JavaScript</h2>
<div class="fragment"><div class="line">// Load the file module from the class binding example and the</div><div class="line">// console module.</div><div class="line">var file    = require(&#39;file&#39;),</div><div class="line">    console = require(&#39;console&#39;)</div><div class="line"></div><div class="line">var writer = new file.writer(&quot;file&quot;)</div><div class="line">if (writer.is_open()) {</div><div class="line">    writer.println(&quot;some text&quot;)</div><div class="line">    writer.close()</div><div class="line">    if (! file.rename(&quot;file&quot;, &quot;newfile&quot;))</div><div class="line">        console.log(&quot;could not rename file&quot;)</div><div class="line">}</div><div class="line">else console.log(&quot;could not open `file&#39;&quot;)</div><div class="line"></div><div class="line">console.log(&quot;exit&quot;)</div></div><!-- fragment --><h2>Create a handle to an externally referenced C++ class.</h2>
<div class="fragment"><div class="line">{c++}</div><div class="line">// Memory for C++ class will remain when JavaScript object is deleted.</div><div class="line">// Useful for classes you only wish to inject.</div><div class="line">typedef v8pp::class_&lt;my_class&gt; my_class_wrapper(isolate);</div><div class="line">v8::Handle&lt;v8::Value&gt; val = my_class_wrapper::reference_external(&amp;my_class::instance());</div><div class="line">// Assuming my_class::instance() returns reference to class</div></div><!-- fragment --><h2>Import externally created C++ class into v8pp.</h2>
<div class="fragment"><div class="line">{c++}</div><div class="line">// Memory for c++ object will be reclaimed by JavaScript using &quot;delete&quot; when</div><div class="line">// JavaScript class is deleted.</div><div class="line">typedef v8pp::class_&lt;my_class&gt; my_class_wrapper(isolate);</div><div class="line">v8::Handle&lt;v8::Value&gt; val = my_class_wrapper::import_external(new my_class);</div></div><!-- fragment --><h2>Compile-time configuration</h2>
<p class="">The library uses several preprocessor macros, defined in <code><a class="el" href="config_8hpp_source.html">v8pp/config.hpp</a></code> file:</p>
<ul>
<li><code>V8PP_ISOLATE_DATA_SLOT</code> - A v8::Isolate data slot number, used to store v8pp internal data</li>
<li><code>V8PP_PLUGIN_INIT_PROC_NAME</code> - Plugin initialization procedure name that should be exported from a v8pp plugin.</li>
<li><code>V8PP_PLUGIN_SUFFIX</code> - Plugin filename suffix that would be added if the plugin name used in <code>require()</code> doesn't end with it.</li>
<li><code>V8PP_HEADER_ONLY</code> - Use header-only implemenation, enabled by default.</li>
</ul>
<h2>v8pp alternatives</h2>
<ul>
<li><a href="https://github.com/charto/nbind">nbind</a></li>
<li><a href="https://github.com/tsa/vu8">vu8</a>, abandoned</li>
<li><a href="http://code.google.com/p/v8-juice/">v8-juice</a>, abandoned</li>
<li>Script bindng in <a href="https://github.com/cpgf/cpgf">cpgf</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 25 2019 17:27:36 for v8pp by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
